# 27-28d

## day27

### 保护应用程序

我们创建了一段攻击代码

```asm
[FORMAT "WCOFF"]
[INSTRSET "i486p"]
[BITS 32]
[FILE "crack7.nas"]

		GLOBAL	_HariMain

[SECTION .text]

_HariMain:
		MOV		AX,1005*8
		MOV		DS,AX
		CMP		DWORD [DS:0x0004],'Hari'
		JNE		fin					

		MOV		ECX,[DS:0x0000]	
		MOV		AX,2005*8
		MOV		DS,AX

crackloop:						
		ADD		ECX,-1
		MOV		BYTE [DS:ECX],123
		CMP		ECX,0
		JNE		crackloop

fin:							
		MOV		EDX,4
		INT		0x40

```

这段代码首先检查要攻击的段(1005号)是否为应用程序, 如果是的话则跳转到2005号段, 并将内容全部改为123

1005号段即我们打开的第一个应用程序的代码段, 而2005号则是数据段, 如果我们将数据全部改为乱码的话程序将会无法运行

为了保护应用程序, 我们需要禁止应用程序修改其他应用程序, 这个时候我们可以用到LDT

我们在任务struct